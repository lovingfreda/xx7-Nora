<template>
  <div class="page" data-name="catalog">
    <div class="navbar">
      <div class="navbar-bg"></div>
      <div class="navbar-inner sliding">
        <div class="title">Schedule</div>
        <div class="right">
          <a class="link" @click=${togglePosition}>
            <i class="md-only icon material-icons rotate-icon">compare_arrows</i>
            <i class="if-not-md icon f7-icons">arrow_up_arrow_down_circle_fill</i>
          </a>
        </div>
      </div>
    </div>

    <!-- -----------Tabbar With Labels--------------- -->
    <div class="toolbar tabbar-labels toolbar-top">
      <div class="toolbar-inner">
        <a href="#tab-1" class="tab-link tab-link-active">
          <i class="icon f7-icons if-not-md">envelope_fill</i>
          <i class="icon material-icons md-only">email</i>
          <span class="tabbar-label">活动日程</span>
        </a>
        <a href="#tab-2" class="tab-link" @click=${toggleMyArrange}>
          <i class="icon f7-icons if-not-md">today_fill</i>
          <i class="icon material-icons md-only">today</i>
          <span class="tabbar-label">我的安排</span>
        </a>
        <a href="#tab-3" class="tab-link" @click=${toggleMySuggestion}>
          <i class="icon f7-icons if-not-md">cloud_upload_fill<span class="badge color-red">5</span></i>
          <i class="icon material-icons md-only">file_upload<span class="badge color-red">5</span></i>
          <span class="tabbar-label">推荐</span>
        </a>
      </div>
    </div>
    <!-- ---------------------------------------------- -->

    <div class="tabs">
      <div class="page-content tab tab-active" id="tab-1">
        <div class="block">
          <p><b>Tab 1 content</b></p>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Itaque quos asperiores ut, odio numquam ab, qui,
            alias adipisci in magni reiciendis reprehenderit. Labore esse quae ut tempore consequatur, reprehenderit
            similique!</p>
        </div>
        <!-- ============================================== -->
        <!--
        Additional "timeline-horizontal" class to enable Horizontal timeline
        Additional "col-50" to define column width (50%)
        Additional "tablet-20" to define column width for tablets (20%)
        -->
        ${events.value.length > 0 ? $h`
          <!-- ----------------------- Outer Loop : When N-Days Array events[..] is Not Null,  do the logic below  ------------- -->
          <div class="block-title">timeline-horizontal</div>
          <div class="timeline timeline-horizontal col-50 tablet-20">
              ${events.value.map((line) => $h`
              <!-- Timeline Item (Day) -->
              <div class="timeline-item">
                <div class="timeline-item-date">${line.date_title} <small></small></div>
                <div class="timeline-item-content">
                  <!-- <div class="timeline-item-inner">  !!! Example here.. !!!
                    <div class="timeline-item-time">12:56</div>
                    <div class="timeline-item-title">Title 1</div>
                    <div class="timeline-item-subtitle">Subtitle 1</div>
                    <div class="timeline-item-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit</div>
                  </div> -->
                  <!-- ----------------------- Inner Loop: each day have a different activity list  ------------- -->
                  ${artidaily.value.length > 0 ? $h`

                      ${artidaily.value.map((dailyLine) => (line.date_start === dailyLine.date_start ? $h`
                          <!-- Some data show in Col-1, others show in Col-2..Col-3....Col-N -->
                          <!-- We using AAA === BBB ? H : N,  and first we should mapping to daily--lines  -->
                          <div class="timeline-item-inner">
                            <div class="timeline-item-time">${dailyLine.time_st} - ${dailyLine.time_ed}</div>
                            <div class="timeline-item-title"><small>${dailyLine.title}</small></div>
                            <div class="timeline-item-subtitle"></div>
                            <div class="timeline-item-text">${dailyLine.desc}</div>
                          </div>
                          ` : '')
                      )}

                  ` : $h`
                      <!-- <div class="timeline-item-inner">
                        <div class="timeline-item-time">12:56</div>
                        <div class="timeline-item-text">No Action goes here</div>
                      </div>
                      ... -->
                  `}
                  <!-- ----------------------- Inner Loop: FINISHED   FINISHED   FINISHED   FINISHED  ------------- -->
                </div>
              </div>
              `)}
          </div>
          <!-- ----------------------- Outer Loop : if true {do sometHing} FINISHED  FINISHED  FINISHED  FINISHED    ----------- -->
        ` : $h`
          <!-- ----------------------- Outer Loop : if falae {do another thing here}  ------------- -->
          <div>NO RECORDS [LINE 97] FILE [schedule.f7]</div>
        `}

        <!-- ============================================== -->
        <!-- Tab 1 Ending -->
        <!-- ============================================== -->
      </div>
      <div class="page-content tab" id="tab-2">
        <div class="block">
          <p><b>Tab 2 content</b></p>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Itaque quos asperiores ut, odio numquam ab, qui,
            alias adipisci in magni reiciendis reprehenderit. Labore esse quae ut tempore consequatur, reprehenderit
            similique!</p>
        </div>
        <!-- ============================================== -->
        <!--
        Additional "timeline-horizontal" class to enable Horizontal timeline
        Additional "col-50" to define column width (50%)
        Additional "tablet-20" to define column width for tablets (20%)
        -->
        ${events.value.length > 0 ? $h`
          <!-- ----------------------- Outer Loop : When N-Days Array events[..] is Not Null,  do the logic below  ------------- -->
          <div class="block-title">timeline-horizontal</div>
          <div class="timeline">
              ${events.value.map((line) => $h`
              <!-- Timeline item with special timeline elements and inner (Day) -->
              <div class="timeline-item">
                <div class="timeline-item-date">${line.date_title} <small></small></div>
                <div class="timeline-item-divider"></div>
                <div class="timeline-item-content">
                  <!--                             !!! Example here.. !!!
                    <div class="timeline-item-content">
                      <div class="timeline-item-time">12:33</div>
                      <div class="timeline-item-title">Item Title</div>
                      <div class="timeline-item-subtitle">Item Subtitle</div>
                      <div class="timeline-item-text">Item Text</div>
                    </div> -->
                  <!-- ----------------------- Inner Loop: each day have a different activity list  ------------- -->
                  ${myarrange.value.length > 0 ? $h`

                      ${myarrange.value.map((dailyLine) => (line.date_start === dailyLine.date_start ? $h`
                          <!-- Some data show in Col-1, others show in Col-2..Col-3....Col-N -->
                          <!-- We using AAA === BBB ? H : N,  and first we should mapping to daily--lines  -->
                          <div class="timeline-item-inner">
                            <div class="timeline-item-time">${dailyLine.time_st} - ${dailyLine.time_ed}</div>
                            <div class="timeline-item-title"><small>${dailyLine.title}</small></div>
                            <div class="timeline-item-subtitle"></div>
                            <div class="timeline-item-text">${dailyLine.desc}</div>
                          </div>
                          ` : '')
                      )}

                  ` : $h`
                      <!-- <div class="timeline-item-inner">
                        <div class="timeline-item-time">12:56</div>
                        <div class="timeline-item-text">No Action goes here</div>
                      </div>
                      ... -->
                  `}
                  <!-- ----------------------- Inner Loop: FINISHED   FINISHED   FINISHED   FINISHED  ------------- -->
                </div>
              </div>
              `)}
          </div>
          <!-- ----------------------- Outer Loop : if true {do sometHing} FINISHED  FINISHED  FINISHED  FINISHED    ----------- -->
        ` : $h`
          <!-- ----------------------- Outer Loop : if falae {do another thing here}  ------------- -->
          <div>NO RECORDS [LINE 164] FILE [schedule.f7]</div>
        `}

        <!-- ============================================== -->
        <!-- Tab 2 Ending -->
        <!-- ============================================== -->
      </div>
      <div class="page-content tab" id="tab-3">
<form action="http://portal.kideduc.com/api/EditUser.php?user_id=${users.value.length > 0 ? users.value[0].id : -1}&ccsForm=users%3AEdit" method="POST" class="list form-ajax-submit" id="kitty-form">
        <div class="block">
          <p><b>Tab 3 content</b></p>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Itaque quos asperiores ut, odio numquam ab, qui,
            alias adipisci in magni reiciendis reprehenderit. Labore esse quae ut tempore consequatur, reprehenderit
            similique!</p>
          <p class="row">
            <div class="col"><button class="col button button-fill" type="submit">标记已读</button></div>
            <div class="col"></div>
            <div class="col"><a class="button button-fill fill-form-from-data"  href="#">debug..</a></div>
            <div class="col"></div>
          </p>
        </div>
</form>
        <!-- ============================================== -->
        <!--
        Additional "timeline-horizontal" class to enable Horizontal timeline
        Additional "col-50" to define column width (50%)
        Additional "tablet-20" to define column width for tablets (20%)
        -->
        ${events.value.length > 0 ? $h`
          <!-- ----------------------- Outer Loop : When N-Days Array events[..] is Not Null,  do the logic below  ------------- -->
          <div class="block-title">timeline-horizontal</div>
          <div class="timeline timeline-sides">
              ${events.value.map((line) => $h`
              <!-- Timeline Item (Day) -->
              <div class="timeline-item">
                <div class="timeline-item-date">${line.date_title} <small></small></div>
                <div class="timeline-item-divider"></div>
                <div class="timeline-item-content">
                     <!-- <div class="timeline-item">
                            <div class="timeline-item-date">21 <small>DEC</small></div>
                            <div class="timeline-item-divider"></div>
                            <div class="timeline-item-content">
                              <div class="timeline-item-inner">Some text goes here</div>
                            </div>
                          </div> -->
                  <!-- ----------------------- Inner Loop: each day have a different activity list  ------------- -->
                  ${mysuggest.value.length > 0 ? $h`

                      ${mysuggest.value.map((dailyLine) => (line.date_start === dailyLine.date_start ? $h`
                          <!-- Some data show in Col-1, others show in Col-2..Col-3....Col-N -->
                          <!-- We using AAA === BBB ? H : N,  and first we should mapping to daily--lines  -->
                          <div class="timeline-item-inner">
                            <div class="timeline-item-time">${dailyLine.time_st} - ${dailyLine.time_ed}</div>
                            <div class="timeline-item-title"><small>${dailyLine.title}</small></div>
                            <div class="timeline-item-subtitle"></div>
                            <div class="timeline-item-text">${dailyLine.desc}</div>
                          </div>
                          ` : '')
                      )}

                  ` : $h`
                      <!-- <div class="timeline-item-inner">
                        <div class="timeline-item-time">12:56</div>
                        <div class="timeline-item-text">No Action goes here</div>
                      </div>
                      ... -->
                  `}
                  <!-- ----------------------- Inner Loop: FINISHED   FINISHED   FINISHED   FINISHED  ------------- -->
                </div>
              </div>
              `)}
          </div>
          <!-- ----------------------- Outer Loop : if true {do sometHing} FINISHED  FINISHED  FINISHED  FINISHED    ----------- -->
        ` : $h`
          <!-- ----------------------- Outer Loop : if falae {do another thing here}  ------------- -->
          <div>NO RECORDS [LINE 231] FILE [schedule.f7]</div>
        `}

        <!-- ============================================== -->
        <!-- Tab 3 Ending -->
        <!-- ============================================== -->
        <!-- Each next item will on different side -->
        <!-- 
        <div class="block-title">Side By Side</div>
        <div class="timeline timeline-sides">
          <div class="timeline-item">
            <div class="timeline-item-date">21 <small>DEC</small></div>
            <div class="timeline-item-divider"></div>
            <div class="timeline-item-content">
              <div class="timeline-item-inner">Some text goes here</div>
            </div>
          </div>
          <div class="timeline-item">
            <div class="timeline-item-date">22 <small>DEC</small></div>
            <div class="timeline-item-divider"></div>
            <div class="timeline-item-content">
              <div class="timeline-item-inner">Another text goes here</div>
            </div>
          </div>
          <div class="timeline-item">
            <div class="timeline-item-date">23 <small>DEC</small></div>
            <div class="timeline-item-divider"></div>
            <div class="timeline-item-content">
              <div class="timeline-item-inner">Just plain text</div>
            </div>
          </div>
          <div class="timeline-item">
            <div class="timeline-item-date">24 <small>DEC</small></div>
            <div class="timeline-item-divider"></div>
            <div class="timeline-item-content">
              <div class="timeline-item-inner">One more text here</div>
            </div>
          </div>
        </div> -->
        <!-- ============================================== -->
      </div>
    </div>

    <div class="page-content">
      <div class="list links-list">

      </div> <!-- End of <div class="list links-list"> -->
    </div>

  </div>
</template>
<script>
  export default (props, {$, $on, $f7, $store }) => {
    //----------------------------------------------------
    const loading = $store.getters.loading;
    const users   = $store.getters.users;
    //----------------------------------------------------
    // Component Data
    let $toolbarEl;

    // Component Methods
    const togglePosition = () => {
      $toolbarEl.toggleClass('toolbar-bottom toolbar-top');
    }

    const toggleMyArrange = () => {     // Tab 2  <My Arrange>    trigger
      console.log("---- toggleMyArrange exec");
      //----------------------------------------------------
      const loading = $store.getters.loading;
      const users   = $store.getters.users;
      //----------------------------------------------------
      $store.dispatch('getMyArrange',   { userID:'eva'} );   // Ajax Get Data...// bug here

    }

    const toggleMySuggestion = () => {  // Tab 3  <My Suggestion> trigger
      console.log("---- toggleMySuggestion exec");
      //----------------------------------------------------
      //const loading = $store.getters.loading;
      //const users   = $store.getters.users;
      //----------------------------------------------------
      $store.dispatch('getMySuggest',   { userID:'yangy'} );   // Ajax Get Data...// bug here

    }
    // Lifecycle

    // Page Events
    $on('pageInit', (e, page) => {
      $toolbarEl = page.$el.find('.toolbar');

      $store.dispatch('getEvents',   { catgID:'1'} );   // Outer Loop : Each Daily
      $store.dispatch('getArtiDaily',{ userID:'-1'});   // Inner Loop : Each Line of that Day

      $('.fill-form-from-data').on('click', function(){
          console.log("Form Action URL:! " + $f7.$('form#kitty-form').attr('action'));
      });

    });

    // -------------------------------------    App Events  -----------------------------------------
    const events    = $store.getters.events;
    const artidaily = $store.getters.artidaily; // Tab-1 : Whole Activity

    const myarrange = $store.getters.myarrange; // Tab-2 : My Arranges
    const mysuggest = $store.getters.mysuggest; // Tab-3 : My Suggestions
    //----------------------------------------------------

    return $render;
  }

</script>
